<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>My Simple Forum (Full Name & Chat Bubbles)</title>
  <style>
    /* Basic page styling */
    body {
      font-family: sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      text-align: center;
    }

    /* Container holding the chat messages */
    #messageList {
      border: 1px solid #ccc;
      background-color: #fff;
      padding: 10px;
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 20px;
    }

    /* Base styling for each chat bubble */
    .messageItem {
      display: inline-block;
      clear: both; /* ensures each message starts on a new line */
      margin-bottom: 10px;
      max-width: 60%; /* limit bubble width so it doesn't span full width */
      position: relative; /* allows positioning of arrow pseudo-element */
      padding: 10px 15px;
      border-radius: 20px;
      word-wrap: break-word; /* handle long words gracefully */
    }

    /* Bubbles for the current user */
    .myMessage {
      float: right; /* aligns user's messages to the right */
      background-color: #DCF8C6; /* typical "sent" bubble color (light green) */
      text-align: left; /* keep text left-aligned inside the bubble */
    }

    /* Arrow for the user's bubble (on the right side) */
    .myMessage::after {
      content: "";
      position: absolute;
      right: -10px; /* positions the arrow tip slightly outside the bubble */
      top: 15px;
      width: 0;
      height: 0;
      border: 10px solid transparent;
      border-left-color: #DCF8C6; /* match the bubble's background color */
    }

    /* Bubbles for other users */
    .otherMessage {
      float: left; /* aligns other users' messages to the left */
      background-color: #fff; /* typical "received" bubble color (white) */
      border: 1px solid #ccc;
    }

    /* Arrow for other users' bubbles (on the left side) */
    .otherMessage::after {
      content: "";
      position: absolute;
      left: -10px;
      top: 15px;
      width: 0;
      height: 0;
      border: 10px solid transparent;
      border-right-color: #fff; /* match the bubble's background color */
    }

    /* The sender's name inside the bubble */
    .senderName {
      font-size: 0.8em;
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }

    /* The main text content of the message */
    .messageText {
      font-size: 1em;
      white-space: pre-wrap; /* preserve line breaks from textarea */
    }

    /* Container for the input and send button */
    .inputContainer {
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    /* The textarea for new messages */
    #messageInput {
      resize: none; /* remove corner drag in some browsers */
      padding: 8px;
      font-size: 1em;
      margin-bottom: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    /* The send button */
    #sendButton {
      align-self: flex-end;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #009688;
      color: #fff;
    }
    #sendButton:hover {
      background-color: #00796b;
    }
  </style>
</head>
<body>
  <h1>My Simple Forum</h1>

  <!-- Container where messages are displayed -->
  <div id="messageList"></div>

  <!-- Input area for sending new messages -->
  <div class="inputContainer">
    <textarea id="messageInput" rows="3" placeholder="Type your message here..."></textarea>
    <button id="sendButton">Send</button>
  </div>

  <!-- Firebase SDK Scripts (compat versions) -->
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>

  <script>
    /************************************************
     * 1. Insert Your Real Firebase Project Config *
     ************************************************/
const firebaseConfig = {
  apiKey: "AIzaSyAtp6T37Mpb0n5PljcxtWBFsS7AbRGcZz4",
  authDomain: "mp-forum.firebaseapp.com",
  projectId: "mp-forum",
  storageBucket: "mp-forum.firebasestorage.app",
  messagingSenderId: "331366400336",
  appId: "1:331366400336:web:0897f612740510001cac55",
  measurementId: "G-3QMKRX9T5H"
};

    /********************************************
     * 2. Initialize Firebase and Database Ref  *
     ********************************************/
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const messagesRef = db.ref("forumMessages"); 
    // "forumMessages" is an arbitrary path name

    /*********************************************************
     * 3. Get User Info from localStorage (Full Name & Email)*
     *********************************************************/
    const userEmail = localStorage.getItem('playerEmail') || 'anonymous@example.com';
    const userFullName = localStorage.getItem('fullName') || 'Anonymous';

    /**********************
     * 4. DOM References  *
     **********************/
    const messageList = document.getElementById("messageList");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");

    /********************************************************
     * 5. Listen for New Messages (child_added) in Real-Time*
     ********************************************************/
    messagesRef.on("child_added", (snapshot) => {
      const data = snapshot.val();
      addMessageToUI(data.email, data.fullName, data.text);
    });

    /**************************************************************
     * 6. Add a Message Bubble to the UI (Shows Full Name Instead)*
     **************************************************************/
    function addMessageToUI(senderEmail, senderFullName, text) {
      // Determine if it's the current user's message
      const isMyMessage = (senderEmail === userEmail);

      // Create the bubble wrapper
      const wrapper = document.createElement("div");
      wrapper.classList.add("messageItem");
      wrapper.classList.add(isMyMessage ? "myMessage" : "otherMessage");

      // Choose the display name
      // Option A: always show the actual sender's name
      let displayName = senderFullName;

      // If you want your own messages to say "You" instead, do:
      // let displayName = isMyMessage ? "You" : senderFullName;

      // Create sender name div
      const nameDiv = document.createElement("div");
      nameDiv.classList.add("senderName");
      nameDiv.textContent = displayName;
      wrapper.appendChild(nameDiv);

      // Create message text div
      const textDiv = document.createElement("div");
      textDiv.classList.add("messageText");
      textDiv.textContent = text;
      wrapper.appendChild(textDiv);

      // Append to the message list
      messageList.appendChild(wrapper);
      messageList.scrollTop = messageList.scrollHeight;
    }

    /**************************************************
     * 7. Send a New Message to Firebase on Click     *
     **************************************************/
    sendButton.addEventListener("click", () => {
      const text = messageInput.value.trim();
      if (!text) return; // don't send empty messages

      // Push message to Realtime Database
      messagesRef.push({
        email: userEmail,         // unique identifier for ownership
        fullName: userFullName,   // for display in the bubble
        text: text,
        timestamp: Date.now()
      });

      // Clear the input
      messageInput.value = "";
    });
  </script>
</body>
</html>
